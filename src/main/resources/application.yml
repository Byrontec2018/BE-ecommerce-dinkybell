
# =============================
# Dinkybell E-Commerce Backend Configuration
# =============================

spring:
  application:
    name: ecommerce  # Spring Boot application name

  # =============================
  # PostgreSQL Database Configuration
  # =============================
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:dinkybell_db}  # Database connection URL
    username: ${DB_USER:admin}  # Database username
    password: ${DB_PASSWORD:Admin}  # Database password
    driver-class-name: org.postgresql.Driver  # JDBC driver

  # =============================
  # JPA/Hibernate Configuration
  # =============================
  jpa:
    hibernate:
      ddl-auto: update  # Update database schema at startup
    show-sql: false  # Show SQL queries in console
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect  # PostgreSQL dialect
        format_sql: true  # Format printed SQL queries

  # =============================
  # Redis Configuration
  # =============================
  data:
    redis:
      host: ${REDIS_HOST:localhost}  # Redis host
      port: ${REDIS_PORT:6379}  # Redis port
      password: ${REDIS_PASSWORD:dinkybell_redisAdmin}  # Redis password (if set)
      repositories:
        enabled: false  # Disable Spring Data Redis repositories

  # =============================
  # Email Configuration (Spring Mail)
  # =============================
  mail:
    host: ${EMAIL_HOST:smtp.hostinger.com}  # SMTP host
    port: ${EMAIL_PORT:465}  # SMTP port (465 for SSL/TLS, 587 for STARTTLS)
    username: ${EMAIL_USERNAME:support@dinkybell.com}  # SMTP username (email format)
    password: ${EMAIL_PASSWORD:Sushi1407!}  # SMTP password
    properties:
      mail:
        smtp:
          auth: true  # Enable SMTP authentication
          ssl:
            enable: true  # Enable SSL for port 465
            trust: smtp.hostinger.com  # Trust the SMTP host
          starttls:
            enable: false  # Disable STARTTLS for SSL port 465
            required: false  # STARTTLS not required for SSL
          connectiontimeout: 10000  # Connection timeout in milliseconds
          timeout: 10000  # SMTP timeout in milliseconds
          writetimeout: 10000  # SMTP write timeout in milliseconds
          # Additional properties for SSL/TLS
          socketFactory:
            port: 465
            class: javax.net.ssl.SSLSocketFactory
            fallback: false


# =============================
# Allow bean overriding (useful for Resilience4j)
# =============================
main:
  allow-bean-definition-overriding: true

# =============================
# JWT Configuration
# =============================
jwt:
  access-token:    
    expiration: 300000  # Access token expiry in milliseconds (5 min) TESTING PURPOSES
    # expiration: 3600000  # Access token expiry in milliseconds (1 hour)
  refresh-token:
    expiration: 2592000000  # Refresh token expiry in milliseconds (30 days)
  
  # Keystore configuration for persistent JWT signing keys
  keystore:
    path: ${JWT_KEYSTORE_PATH:./jwt-keystore.jceks}
    password: ${JWT_KEYSTORE_PASSWORD:developmentPassword123}
    alias: ${JWT_KEYSTORE_ALIAS:jwt-key}
    type: ${JWT_KEYSTORE_TYPE:JCEKS}

# =============================
# Management Endpoints Configuration
# =============================
management:
  endpoint:
    health:
      show-details: always  # Always show health endpoint details

# =============================
# Resilience4j Rate Limiting Configuration
# =============================
resilience4j:
  ratelimiter:
    instances:
      # Login endpoint: very restrictive
      login:
        limitForPeriod: 3
        limitRefreshPeriod: 300s
        timeoutDuration: 0
      # Registration endpoint: even more restrictive
      register:
        limitForPeriod: 2
        limitRefreshPeriod: 600s
        timeoutDuration: 0
      # Reset password endpoint: most restrictive
      resetPassword:
        limitForPeriod: 1
        limitRefreshPeriod: 900s
        timeoutDuration: 0
      # Confirm reset password endpoint: restrictive
      confirmResetPassword:
        limitForPeriod: 2
        limitRefreshPeriod: 600s
        timeoutDuration: 0
      # Refresh token endpoint: moderately restrictive
      refreshToken:
        limitForPeriod: 2
        limitRefreshPeriod: 60s
        timeoutDuration: 0