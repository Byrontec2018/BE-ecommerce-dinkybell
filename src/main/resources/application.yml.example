# =============================
# Dinkybell E-Commerce Backend Configuration - EXAMPLE
# =============================
# Copy this file to application.yml and configure with your actual values

spring:
  application:
    name: ecommerce  # Spring Boot application name

  # =============================
  # PostgreSQL Database Configuration
  # =============================
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:dinkybell_db}  # Database connection URL
    username: ${DB_USER:postgres}  # Database username
    password: ${DB_PASSWORD:your_secure_password}  # Database password - SET via environment variable
    driver-class-name: org.postgresql.Driver  # JDBC driver

  # =============================
  # JPA/Hibernate Configuration
  # =============================
  jpa:
    hibernate:
      ddl-auto: update  # Update database schema at startup
    show-sql: false  # Show SQL queries in console
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect  # PostgreSQL dialect
        format_sql: true  # Format printed SQL queries

  # =============================
  # Redis Configuration
  # =============================
  data:
    redis:
      host: ${REDIS_HOST:localhost}  # Redis host
      port: ${REDIS_PORT:6379}  # Redis port
      password: ${REDIS_PASSWORD:}  # Redis password (if set) - SET via environment variable
      repositories:
        enabled: false  # Disable Spring Data Redis repositories

  # =============================
  # Email Configuration (Spring Mail)
  # =============================
  mail:
    host: ${EMAIL_HOST:smtp.gmail.com}  # SMTP host
    port: ${EMAIL_PORT:587}  # SMTP port (465 for SSL/TLS, 587 for STARTTLS)
    username: ${EMAIL_USERNAME:your_email@example.com}  # SMTP username (email format) - SET via environment variable
    password: ${EMAIL_PASSWORD:your_app_password}  # SMTP password - SET via environment variable
    properties:
      mail:
        smtp:
          auth: true  # Enable SMTP authentication
          starttls:
            enable: true  # Enable STARTTLS for port 587
            required: true  # STARTTLS required
          connectiontimeout: 10000  # Connection timeout in milliseconds
          timeout: 10000  # SMTP timeout in milliseconds
          writetimeout: 10000  # SMTP write timeout in milliseconds

# =============================
# Allow bean overriding (useful for Resilience4j)
# =============================
main:
  allow-bean-definition-overriding: true

# =============================
# JWT Configuration
# =============================
jwt:
  access-token:    
    expiration: 3600000  # Access token expiry in milliseconds (1 hour)
  refresh-token:
    expiration: 2592000000  # Refresh token expiry in milliseconds (30 days)
  
  # Keystore configuration for persistent JWT signing keys
  keystore:
    path: ${JWT_KEYSTORE_PATH:./jwt-keystore.jceks}
    password: ${JWT_KEYSTORE_PASSWORD:your_keystore_password}  # SET via environment variable
    alias: ${JWT_KEYSTORE_ALIAS:jwt-key}
    type: ${JWT_KEYSTORE_TYPE:JCEKS}

# =============================
# Management Endpoints Configuration
# =============================
management:
  endpoint:
    health:
      show-details: always  # Always show health endpoint details

# =============================
# Resilience4j Rate Limiting Configuration
# =============================
resilience4j:
  ratelimiter:
    instances:
     # Login endpoint: very restrictive
      login:
        limitForPeriod: 3
        limitRefreshPeriod: 300s
        timeoutDuration: 0
      # Registration endpoint: even more restrictive
      register:
        limitForPeriod: 20 # Allow more registration attempts to accommodate new users, but still limit to prevent abuse
        limitRefreshPeriod: 600s
        timeoutDuration: 0
      # Reset password endpoint: most restrictive
      resetPassword:
        limitForPeriod: 1
        limitRefreshPeriod: 900s
        timeoutDuration: 0
      # Confirm reset password endpoint: restrictive
      confirmResetPassword:
        limitForPeriod: 2
        limitRefreshPeriod: 600s
        timeoutDuration: 0
      # Refresh token endpoint: moderately restrictive
      refreshToken:
        limitForPeriod: 2
        limitRefreshPeriod: 60s
        timeoutDuration: 0
      # Logout endpoint: moderately restrictive
      logout:
        limitForPeriod: 5
        limitRefreshPeriod: 300s
        timeoutDuration: 0      # 
      # Email verification endpoint: restrictive to prevent abuse
      verifyEmail:
        limitForPeriod: 5
        limitRefreshPeriod: 600s
        timeoutDuration: 0
      # Resend verification email endpoint: restrictive to prevent abuse
      resendVerificationEmail:
        limitForPeriod: 5 
        limitRefreshPeriod: 600s
        timeoutDuration: 0  